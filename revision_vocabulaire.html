<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Espagnol LÃ©onard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="index.html" class="back-btn">Retour</a>
    <div class="navbar"><div class="navbar-content"><h1>ES - Quiz Vocabulaire</h1></div></div>
    <div class="container">
        <div class="header-section">
            <div class="score-display"><span id="scoreValue">0</span>/<span id="maxQuestions">10</span></div>
            <div class="header-result" id="headerResult" style="display: none;"><div class="header-result-text" id="headerResultText"></div></div>
            <div class="settings-section">
                <label>Questions:</label><select id="numQuestions" onchange="changerNombreQuestions()"><option value="10" selected>10</option><option value="20">20</option><option value="30">30</option></select>
                <div class="toggle-section">
                    <label>Mode:</label>
                    <button class="toggle-btn active" id="modeES" onclick="changerMode('ES')">ES â†’ FR</button>
                    <button class="toggle-btn" id="modeFR" onclick="changerMode('FR')">FR â†’ ES</button>
                </div>
            </div>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div id="gameContainer">
            <div class="card-vocabulary">
                <div class="word-label" id="wordLabel">Traduis en franÃ§ais:</div>
                <div class="word-display" id="wordDisplay">Chargement...</div>
                <button class="listen-btn" id="listenBtn" onclick="ecouterMot()" style="margin-top: 15px;">ðŸ”Š Ã‰couter</button>
            </div>
            <div class="quiz-options" id="quizOptions"></div>
        </div>
        <div id="gameOverContainer" style="display: none;"><div class="game-over"><h2>Quiz terminÃ©!</h2><div class="final-score">Score: <span id="finalScore">0</span>/<span id="finalMax">10</span></div><div style="font-size: 1.5em; color: #26D07C; margin-bottom: 30px;"><span id="percentageValue">0</span>%</div><div id="bonusMessage" style="display: none; color: #FFB800; font-size: 1.2em; margin: 20px 0; font-weight: bold;">ðŸŽ® Parfait! Question bonus Valorant ðŸŽ®</div><button class="btn btn-primary" onclick="recommencer()">Recommencer</button></div></div>
        <div id="bonusContainer" style="display: none;">
            <div class="card-vocabulary">
                <img id="bonusPhoto" src="" alt="Joueur" style="width: 200px; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                <div class="word-display" id="bonusNickname" style="font-size: 1.3em;">Joueur</div>
                <div class="word-label" id="bonusQuestion" style="margin-top: 20px;">Question</div>
            </div>
            <div class="quiz-options" id="bonusOptions"></div>
        </div>
    </div>
    <script>
        let vocabulaireList = [];
        let valorantPlayers = [];
        let motActuel = null;
        let score = 0;
        let totalQuestions = 0;
        let maxQuestions = 10;
        let modeActuel = 'ES';
        let bonusAnswer = null;
        let bonusPlayer = null;
        let bonusQuestionType = null;
        
        async function chargerVocabulaire() {
            try {
                const res = await fetch('vocabulaire.json?t=' + Date.now());
                const data = await res.json();
                vocabulaireList = data.vocabulaire_A1_A2;
                chargerValorant();
            } catch(e) {
                console.error('Erreur:', e);
                document.getElementById('wordDisplay').textContent = 'Erreur chargement';
            }
        }
        
        async function chargerValorant() {
            try {
                const res = await fetch('valorant.json?t=' + Date.now());
                const data = await res.json();
                valorantPlayers = [
                    ...data.Americas,
                    ...data.EMEA,
                    ...data.Pacific
                ];
                nouvelMot();
            } catch(e) {
                console.error('Erreur Valorant:', e);
                nouvelMot();
            }
        }
        
        function changerMode(mode) {
            modeActuel = mode;
            document.getElementById('modeES').classList.remove('active');
            document.getElementById('modeFR').classList.remove('active');
            if (mode === 'ES') {
                document.getElementById('modeES').classList.add('active');
            } else {
                document.getElementById('modeFR').classList.add('active');
            }
            reinitialiserQuiz();
        }
        
        function ecouterMot() {
            if (!motActuel) return;
            const synthÃ¨se = window.speechSynthesis;
            synthÃ¨se.cancel();
            
            const utterance = new SpeechSynthesisUtterance(motActuel.espagnol_singulier);
            utterance.lang = 'es-ES';
            utterance.rate = 0.9;
            synthÃ¨se.speak(utterance);
        }
        
        function changerNombreQuestions() {
            maxQuestions = parseInt(document.getElementById('numQuestions').value);
            document.getElementById('maxQuestions').textContent = maxQuestions;
            reinitialiserQuiz();
        }
        
        function reinitialiserQuiz() {
            score = 0;
            totalQuestions = 0;
            document.getElementById('scoreValue').textContent = '0';
            document.getElementById('gameContainer').style.display = 'block';
            document.getElementById('gameOverContainer').style.display = 'none';
            document.getElementById('bonusContainer').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
            nouvelMot();
        }
        
        function nouvelMot() {
            if (totalQuestions >= maxQuestions) {
                document.getElementById('finalScore').textContent = score;
                document.getElementById('finalMax').textContent = maxQuestions;
                const pct = Math.round((score / maxQuestions) * 100);
                document.getElementById('percentageValue').textContent = pct;
                
                // Si score parfait et joueurs disponibles
                if (pct === 100 && valorantPlayers.length > 0) {
                    genererBonusValorant();
                    return;
                }
                
                document.getElementById('gameContainer').style.display = 'none';
                document.getElementById('gameOverContainer').style.display = 'block';
                return;
            }
            
            const idx = Math.floor(Math.random() * vocabulaireList.length);
            motActuel = vocabulaireList[idx];
            
            let motAffiche, bonneReponse, label;
            
            if (modeActuel === 'ES') {
                motAffiche = motActuel.espagnol_singulier;
                bonneReponse = motActuel.francais;
                label = 'Traduis en franÃ§ais:';
            } else {
                motAffiche = motActuel.francais;
                bonneReponse = motActuel.espagnol_singulier;
                label = 'Traduis en espagnol:';
            }
            
            document.getElementById('wordLabel').textContent = label;
            document.getElementById('wordDisplay').textContent = motAffiche;
            document.getElementById('listenBtn').style.display = 'block';
            document.getElementById('headerResult').style.display = 'none';
            
            let options = [bonneReponse];
            
            while (options.length < 4) {
                let optionAlternative;
                if (modeActuel === 'ES') {
                    optionAlternative = vocabulaireList[Math.floor(Math.random() * vocabulaireList.length)].francais;
                } else {
                    optionAlternative = vocabulaireList[Math.floor(Math.random() * vocabulaireList.length)].espagnol_singulier;
                }
                if (!options.includes(optionAlternative)) {
                    options.push(optionAlternative);
                }
            }
            
            options = options.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('quizOptions');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => {
                    totalQuestions++;
                    const correct = opt === bonneReponse;
                    if (correct) {
                        score++;
                        document.getElementById('scoreValue').textContent = score;
                        btn.classList.add('correct');
                        document.getElementById('headerResultText').innerHTML = 'Correct!';
                        document.getElementById('headerResultText').className = 'header-result-text correct';
                    } else {
                        btn.classList.add('incorrect');
                        document.getElementById('headerResultText').innerHTML = 'Incorrect';
                        document.getElementById('headerResultText').className = 'header-result-text incorrect';
                    }
                    document.getElementById('progressFill').style.width = ((totalQuestions / maxQuestions) * 100) + '%';
                    document.getElementById('headerResult').style.display = 'flex';
                    document.querySelectorAll('.option-btn').forEach(b => {
                        b.disabled = true;
                        if (b.textContent === bonneReponse) b.classList.add('correct');
                    });
                    setTimeout(() => nouvelMot(), 1500);
                };
                container.appendChild(btn);
            });
        }
        
        function genererBonusValorant() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('gameOverContainer').style.display = 'block';
            document.getElementById('bonusMessage').style.display = 'block';
            
            // SÃ©lectionner un joueur alÃ©atoire
            bonusPlayer = valorantPlayers[Math.floor(Math.random() * valorantPlayers.length)];
            
            // SÃ©lectionner le type de question
            const types = ['role', 'nationality', 'team', 'first_name', 'last_name'];
            bonusQuestionType = types[Math.floor(Math.random() * types.length)];
            
            // DÃ©terminer la bonne rÃ©ponse et la question
            const questionsES = {
                'role': 'Â¿CuÃ¡l es su rol en el equipo?',
                'nationality': 'Â¿De quÃ© paÃ­s es?',
                'team': 'Â¿CuÃ¡l es su equipo?',
                'first_name': 'Â¿CuÃ¡l es su nombre de pila?',
                'last_name': 'Â¿CuÃ¡l es su apellido?'
            };
            
            bonusAnswer = bonusPlayer[bonusQuestionType];
            
            // Afficher la photo et le nickname
            document.getElementById('bonusPhoto').src = bonusPlayer.photo;
            document.getElementById('bonusNickname').textContent = bonusPlayer.nickname;
            document.getElementById('bonusQuestion').textContent = questionsES[bonusQuestionType];
            
            // GÃ©nÃ©rer les options
            let options = [bonusAnswer];
            
            const otherPlayers = valorantPlayers.filter(p => p.nickname !== bonusPlayer.nickname);
            while (options.length < 4 && otherPlayers.length > 0) {
                const randomOther = otherPlayers[Math.floor(Math.random() * otherPlayers.length)];
                const option = randomOther[bonusQuestionType];
                if (!options.includes(option)) {
                    options.push(option);
                }
            }
            
            options = options.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('bonusOptions');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => {
                    const correct = opt === bonusAnswer;
                    if (correct) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                    }
                    document.querySelectorAll('#bonusOptions .option-btn').forEach(b => {
                        b.disabled = true;
                        if (b.textContent === bonusAnswer) b.classList.add('correct');
                    });
                    setTimeout(() => {
                        document.getElementById('bonusContainer').style.display = 'none';
                        document.getElementById('gameOverContainer').style.display = 'block';
                    }, 1500);
                };
                container.appendChild(btn);
            });
            
            document.getElementById('bonusContainer').style.display = 'block';
        }
        
        function recommencer() {
            reinitialiserQuiz();
        }
        
        window.addEventListener('load', () => chargerVocabulaire());
    </script>
</body>
</html>
